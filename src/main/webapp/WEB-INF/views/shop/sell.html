<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>校园二手</title>

    <!-- Google Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Titillium+Web:400,200,300,700,600' rel='stylesheet'
          type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Raleway:400,100' rel='stylesheet' type='text/css'>

    <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="css/font-awesome.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/owl.carousel.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/responsive.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script type="text/javascript">
        function sell() {
            window.location.href = "http://localhost:8080/second/shop/sell.html";
        }
    </script>
</head>
<body>

<div class="header-area">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <div class="user-menu">
                    <ul>
                        <li><a href="http://localhost:8080/second/user/profile.html"><i class="fa fa-user"></i> 个人中心</a></li>
                        <li><a href="cart.html"><i class="fa fa-user"></i> 我的购物车</a></li>
                        <li><a href=""><i class="fa fa-user"></i>退出系统</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-sm-6">
            <div class="logo">
                <h1><a href="./"><img src="img/logo.png"></a></h1>
            </div>
        </div>

        <div class="header-can">
            <div class="search">
                <form>
                    <input type="text" value="Search" onfocus="this.value = '';"
                           onblur="if (this.value == '') {this.value = '';}">

                </form>
            </div>

            <div class="col-md-5">
                <button type="button" class="btn btn-danger" onclick="sell()">我要卖东西</button>
            </div>

        </div>
    </div>
</div> <!-- End site branding area -->
<!-- End header area -->
<div class="container "style="background-color: white;border-width: 20px">
    <div class="row clearfix">
        <div class="col-md-3 column">
        </div>
        <div class="col-md-6 column regist-div">

            <form class="form-horizontal"  >
                <div class="page-header">
                    <div class="image-upload">
                    </div>
                    <div>
                        <input type="file" accept="image/png,image/jpeg,image/PNG, image/jpg,image.JPEG,image/JPG" id="image" value="上传图片"  onchange="uploadImage()"/>
                    </div>
                </div>
                <div class="form-group regist-div">
                    <label  class="col-sm-2 control-label">商品标题</label>
                    <div class="col-sm-10" id="count-div" >
                        <input type="text" class="form-control" id="title" placeholder="请输入标题20字以内标题"/>
                    </div>
                </div>
                <div class="form-group regist-div">
                    <label class="col-sm-2 control-label">商品介绍</label>
                    <div class="col-sm-10">
                        <textarea class="form-control" id="introduce"  rows="5" placeholder="请介绍商品信息"></textarea>
                    </div>
                </div>
                <div class="form-group regist-div">
                    <label  class="col-sm-2 control-label">选择分类</label>
                    <div>
                        <label class="control-label"><input name="type-radio" type="radio" class="radio-inline" value="电子产品"/> 电子产品</label>
                        <label class="control-label"><input name="type-radio" type="radio" class="radio-inline" value="生活用品"/> 生活用品</label>
                        <label class="control-label"><input name="type-radio" type="radio" class="radio-inline" value="数码世界"/> 数码世界</label>
                        <label class="control-label"><input name="type-radio" type="radio" class="radio-inline" value="家用电器"/> 家用电器</label>
                        <label class="control-label"><input name="type-radio" type="radio" class="radio-inline" value="摆件精品"/> 摆件精品</label>
                        <label class="control-label"><input name="type-radio" type="radio" class="radio-inline" value="其他"/> 其他</label>
                    </div>
                </div>

                <div class="form-group regist-div">
                    <label  class="col-sm-2 control-label">价格</label>
                    <div class="col-sm-10">
                        <input type="number" class="form-control" id="price" placeholder="99.99"/>
                    </div>
                </div>
                <div class="form-group regist-div">
                    <label  class="col-sm-2 control-label">出售数量</label>
                    <div class="col-sm-10">
                        <input type="number" class="form-control" id="count" placeholder="1"/>
                    </div>
                </div>

                <div class="form-group regist-div">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button type="button" class="btn-lg btn-success regist-btn"  onclick="sell()">确认出售</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
</body>
</html>


<script>

    function uploadImage() {
        $(document).ready(function () {
            var name = $("#image").val();
            var formData = new FormData();
            formData.append("image",$("#image")[0].files[0]);
            formData.append("name",name);
            $.ajax({
                url : "http://localhost:8080/second/commodity/addphoto",
                type : 'POST',
                data :formData,
                // 告诉jQuery不要去处理发送的数据
                processData : false,
                // 告诉jQuery不要去设置Content-Type请求头
                contentType : false,
                beforeSend:function(){
                    console.log("正在进行，请稍候");
                },
                success : function(data) {
                    alert(data.msg);

                    var imageNode = document.createElement("img");
                    imageNode.src = "http://fudatour.oss-cn-shanghai.aliyuncs.com/secondhand/"+data.model +"?x-oss-process=image/resize,m_mfit,w_120,h_120,limit_0/auto-orient,0/quality,q_90";
                    imageNode.setAttribute("class","imageview");
                    images.append(data.model);
                    var imageDiv = $('.image-upload');
                    imageDiv.append(imageNode);
                },
                error : function(responseStr) {
                    console.log("error");
                }
            });
        });
    }
    var images = [];
    function sell() {

        var checked = $(":input[name='type-radio']:checked").val();
        if (checked == null){
            alert('请选择一个分类');
        }
        else if($("#title").val() == null || $("#title").val().length  < 1 ){
            alert('请输入商品标题')
        }
        else if($("#introduce").val() == null || $("#introduce").val().length < 1){
            alert("请详细描述商品");
        }
        else {

            $(document).ready(function () {
                $.ajax({
                    cache: true,
                    type: "POST",
                    url: "http://localhost:8080/second/commodity/add",
                    data: {
                        "title": $("#title").val(),
                        "describe": $("#introduce").val(),
                        "sortName": $(":input[name='type-radio']:checked").val(),
                        "price": $("#price").val(),
                        "images": images,
                        "numbers": $("#count").val()
                    },
                    async: true,
                    dataType: "json",
                    error: function (xmlhttpRequest) {
                        //这里对错误进行处理
                        alert("error" + xmlhttpRequest.responseText);

                    },
                    success: function (data) {
                        alert("success" + data.msg);
//                       $("body").html(data);
                        window.location.href = data.msg;
                    }
                });
            });
        }
    }
</script>